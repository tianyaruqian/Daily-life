<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册用户</title>
    <link rel="stylesheet" href="/js/bootstrap/css/bootstrap.min.css">
    <style>
        .success
        {
            background-image: url("images/ok.gif");
            background-color:#E6FEE4;
            border-color:#01BE00;
            background-repeat: no-repeat;
            background-position: left 2px;
            padding:0 18px;
        }
        .danger
        {
            background-image: url("/images/err.jpg");
            background-color:#FFF2E5;
            border-color:#FF3300;
            background-repeat: no-repeat;
            background-position: left 2px;
            padding:0 18px;
        }
        span
        {
            background-color:#FFFFDA ;
            border: 1px solid #FFCD00;
            font-size: 16px;
            height: 20px;
            line-height: 20px;
            display: inline-block;
            margin-left: 5px ;

        }
    </style>

</head>
<body>


<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-success">
                <div class="panel-heading">会员注册</div>
                <div class="panel-body">
        <form class="form-horizontal" id="member">
        <div class="form-group">
            <label  class="col-sm-2 control-label">用户名</label>
            <span>请输入4-12位用户名（首位为字母）</span>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="memberName"  onblur="checkUserName()" placeholder="请输入用户名 ...">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label">真实姓名</label>
            <span>请输入您的真实姓名</span>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="realName" placeholder="请输入真实姓名 ..." onblur="checkName()">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label">密码</label>
            <span>密码为6-16位</span>
            <div class="col-sm-4">
                <input type="password" class="form-control" id="password" placeholder="请输入密码" onblur="checkPassWord()">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label">确认密码</label>
            <span>请再次输入密码</span>
            <div class="col-sm-4">
                <input type="password" class="form-control" id="confirmPassword"  placeholder="请再次输入密码" onblur="checkRePassWord()">
            </div>
        </div>
        <div class="form-group" id="area">
            <label  class="col-sm-2 control-label">籍贯</label>
        </div>
        <div class="form-group">
                <label  class="col-sm-2 control-label">手机</label>
            <span>请输入关联手机号</span>
                <div class="col-sm-3">
                    <input type="text" class="form-control" id="phone" placeholder="请输入手机号 ..." maxlength="11" onblur="checkTel()">
                </div>
            </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label">验证码</label>
            <input type="button" class="btn btn-info" id="code"  value="获取验证码" onclick="sendCode()">
            <div class="col-sm-2">
                <input type="text" class="form-control" id="codes" placeholder="请输入验证码 ...">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label">邮箱</label>
            <span>请输入联系邮箱</span>
            <div class="col-sm-2">
                <input type="text" class="form-control" id ="email" placeholder="请输入邮箱 ..." onblur="checkEmail()">
            </div>
        </div>
        <div style="text-align: center">
            <button type="button" class="btn btn-primary" id="submit" onclick="register()"><i class="glyphicon glyphicon-ok" ></i>提交</button>
            <button type="reset" class="btn btn-primary"><i class="glyphicon glyphicon-trash"></i>重置</button>
        </div>
    </form>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/js/jquery-3.3.1.js"></script>
<script src="js/jquery.cookie.min.js"></script>
<script src="/js/bootstrap/js/bootstrap.min.js"></script>
<script src="/js/bootbox/bootbox.min.js"></script>
<script src="/js/bootbox/bootbox.locales.min.js"></script>
<script src="/js/jquery.qrcode.min.js"></script>


<script>
    $(function(){
        initArea(1);
    })

    /**
     * 三级
     * @param id
     * @param obj
     */
    function initArea(id ,obj){
        if(obj){
            $(obj).parent().nextAll().remove();
        }
        $.ajax({
            url:"http://localhost:8086/areas",
            type:"get",
            data:{"id":id},
            beforeSend:function(req){
                //取出cookies;
                var cookie = $.cookie("data_auth");
                req.setRequestHeader("x-token",cookie);

            },
            success:function (res) {
                if(res.code==200){
                    var v_areaList= res.data;
                    //解决没有值继续无限弹出框
                    if(!v_areaList.length>0){
                        return;
                    }
                    var html = '<div class="col-sm-2"><select class="form-control" name="area" onchange="initArea(this.value,this)">'
                    html+='<option value="-1">请选择</option>';
                    for(var i =0;i<v_areaList.length;i++ ){
                        var area = v_areaList[i];
                        html+='<option value="'+area.id+'">'+area.areaName+'</option>'
                    }
                    html+="</select></div>"
                    $("#area").append(html);
                }
            }
        })

    }
//注册
    function register(){
        var a1=$($("select[name='area']")[0]).val();
        var a2=$($("select[name='area']")[1]).val();
        var a3=$($("select[name='area']")[2]).val();
        var v_code =$("#codes").val();
        //获取值
        var param ={};
        param.memberName = $("#memberName").val();
        param.realName = $("#realName").val();
        param.phoneNumber = $("#phone").val();
        param.mpassword = $("#password").val();
        param. email = $("#email").val();
        param.code = v_code;
        param.area1 = a1;
        param.area2 = a2;
        param.area3 = a3;

        $.ajax({
            url: "http://localhost:8086/members",
            type: "post",
            data: param,

            success: function (res) {
                if (res.code == 200) {
                    bootbox.alert({
                        size: "small",
                        title: "用户状态",
                        message: "注册成功",
                    })
                }else{
                    bootbox.alert({
                        size: "small",
                        title: "用户状态",
                        message: res.msg,
                    })
                    }
                }
            })
    }

    //倒计时

    //验证码
    function sendCode(){
        var v_phoneNumber = $("#phone").val();
        if(v_phoneNumber.length==11){
            var code =$("#code");
            code.attr("disabled","disabled");
            setTimeout(function(){
                code.css("opacity","0.8");
            },1000)
            var time = 60;
            var set=setInterval(function(){
                code.val("("+--time+")秒后重新获取");
            }, 1000);
            setTimeout(function(){
                code.attr("disabled",false).val("重新获取验证码");
                clearInterval(set);
            }, 60000);

        }
            $.ajax({
                url:"http://localhost:8086/codes",
                type:"get",
                async:false,
                data:{"phoneNumber":v_phoneNumber},
                success:function (res) {
                    if(res.code==200){
                        bootbox.alert({
                            size: "small",
                            title: "验证状态",
                            message: res.msg,
                        })
                    }else{
                        bootbox.alert({
                            size: "small",
                            title: "验证状态",
                            message: res.msg,
                        })
                    }
                }


            })






    }
    //验证
    //onblur失去焦点事件
    var span = $("form span");
    //用户名
    function checkUserName() {
       var memberName = $("#memberName").val();
        if(memberName.length==0) {
            span[0].innerText='通行证用户名不能为空';
            span[0].className='danger';
            $("#submit").attr("disabled",true);
            return false;
        }
        var pattern=/^[A-Za-z][A-Za-z0-9]{3,11}$/;
        if(!pattern.test(memberName)) {
            span[0].innerText='用户名格式错误，请重新输入';
            span[0].className='danger';
            $("#submit").attr("disabled",true);
            return false;
        }
       $.ajax({
           url:"http://localhost:8086/members",
           type:"get",
           data:{"memberName":memberName},
            success:function (res) {
                if(res.code==200){
                    span[0].innerText='用户名正确,可以注册';
                    span[0].className='success';
                    $("#submit").attr("disabled",false);
                }else {
                    span[0].innerText=res.msg;
                    $("#submit").attr("disabled",true);
                }
            }
       })


    }

    //密码
    function checkPassWord() {
     var mpassword = $("#password").val();
        if(mpassword.length==0) {
            span[2].innerText='密码不能为空';
            span[2].className='danger';
            return false;
        }
        var pattern=/^[A-Za-z0-9]{6,16}$/;
        if(!pattern.test(mpassword.value))
        {
            span[2].innerText='密码不符合格式，请重新输入';
            span[2].className='danger';
            return false;
        }
        span[2].innerText='密码输入正确';
        span[2].className='success';
        return true;
    }

    //重复登录密码
    function checkRePassWord() {
        var confirmPassword = $("#confirmPassword").val();
        var mpassword = $("#password").val();
        console.log(mpassword);
        if(confirmPassword.length==0)
        {
            span[3].innerText='重复密码不能为空';
            span[3].className='danger';
            return false;
        }
        if(confirmPassword!=mpassword)
        {
            span[3].innerText='两次输入的密码不一致，请重新输入';
            span[3].className='danger';
            return false;
        }
        span[3].innerText='两次密码一致';
        span[3].className='success';
        return true;
    }

    //真实姓名（2-4位汉字）
    function checkName() {
        var realName =$("#realName").val();
        if(realName.length==0)
        {
            span[1].innerText='真实姓名不能为空';
            span[1].className='danger';
            return false;
        }
        var pattern=/^[\u4e00-\u9fa5]{2,4}$/;
        if(!pattern.test(realName))
        {
            span[1].innerText='真实姓名格式错误，请重新输入';
            span[1].className='danger';
            return false;
        }
        span[1].innerText='真实姓名输入正确';
        span[1].className='success';
        return true;
    }

    //手机号（）
    function checkTel() {
        var phoneNumber =$("#phone").val();
        if(phoneNumber.length==0) {
            span[4].innerText='手机号不能为空';
            span[4].className='danger';
            $("#code").attr("disabled",true);
            return false;
        }
        var pattern=/^1[34578]\d{9}$/;
        if(!pattern.test(phoneNumber))
        {
            span[4].innerText='手机号码格式错误，请重新输入';
            span[4].className='danger';
            $("#code").attr("disabled",true);
            return false;
        }
        $.ajax({
            url:"http://localhost:8086/members/phone",
            type:"get",
            data:{"phoneNumber":phoneNumber},
            success:function (res) {
                if(res.code==200){
                    span[4].innerText='手机号输入正确,可以注册';
                    span[4].className='success';
                    $("#code").attr("disabled",false);
                }else {
                    span[4].innerText=res.msg;
                    $("#code").attr("disabled",true);
                }
            }
        })
    }

    //邮箱
    function checkEmail() {
        var email = $("#email").val();
        if(email.length==0)
        {
            span[5].innerText='邮箱不能为空';
            span[5].className='danger';
            return false;
        }
        var pattern=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
        if(!pattern.test(email))
        {
            span[5].innerText='邮箱格式错误，请重新输入';
            span[5].className='danger';
            return false;
        }
        $.ajax({
            url:"http://localhost:8086/members/email",
            type:"get",
            data:{"email":email},
            success:function (res) {
                if(res.code==200){
                    span[5].innerText='邮箱输入正确,可以注册';
                    span[5].className='success';

                }else {
                    span[5].innerText=res.msg;
                    //$("#code").attr("disabled",true);
                }
            }
        })
    }



















    //---------------------------------函数封装-------------------------------------------------------------
    //通行证用户名



   /* //邮箱
    function checkEmail(e)
    {
        if(email.value.length==0)
        {
            span[6].innerText='邮箱不能为空';
            span[6].className='danger';
            return false;
        }
        var pattern=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
        if(!pattern.test(email.value))
        {
            span[6].innerText='邮箱格式错误，请重新输入';
            span[6].className='danger';
            return false;
        }
        span[6].innerText='邮箱输入正确';
        span[6].className='success';
        return true;
    }
*/

</script>
</body>
</html>